# 订单提交页面 - IoT设备集成

## 功能概述

订单提交页面已集成IoT设备控制功能，当用户预定成功后，系统会自动检查并控制设备开关一（CHSWT1）的状态。

## 主要功能

### 1. 自动设备控制
- **预定成功后自动触发**：当用户成功提交订单后，系统会自动检查设备开关一的状态
- **智能判断**：如果开关一已经打开，直接提示"设备已通电"
- **自动开启**：如果开关一未打开，系统会自动打开开关一并提示"设备已通电"

### 2. 设备状态检查
- 通过调用 `/device/properties` API 获取设备当前属性
- 检查 `CHSWT1` 属性的值（支持 `'1'`、`1`、`true` 等格式）
- 实时更新本地设备属性缓存

### 3. 设备控制
- 通过调用 `/device/property/set` API 设置设备属性
- 支持设置 `CHSWT1` 为 `'1'` 来打开开关一
- 提供加载状态和错误处理

## 技术实现

### 新增方法

#### `checkAndControlDeviceSwitch()`
- 检查设备开关一状态的入口方法
- 根据开关状态决定是否需要开启设备
- 在预定成功后自动调用

#### `turnOnDeviceSwitch()`
- 打开设备开关一的具体实现
- 显示"正在通电..."加载状态
- 成功后显示"设备已通电"提示

#### `getDeviceProperties()`
- 获取设备所有属性
- 返回Promise，支持异步处理
- 将属性数组转换为键值对格式

#### `setDeviceProperty(identifier, value)`
- 设置指定设备属性
- 支持任意属性和值的设置
- 更新本地属性缓存

### 数据字段

#### `devicePropertyValues: {}`
- 存储设备属性的键值对
- 格式：`{ CHSWT1: '1', CHSWT2: '0', ... }`
- 实时同步设备状态

## 使用流程

1. **用户提交订单**
   - 用户完成订单信息填写
   - 点击提交按钮

2. **订单处理**
   - 系统调用订单提交API
   - 等待服务器响应

3. **预定成功**
   - 显示"预定成功！"提示
   - 自动调用 `checkAndControlDeviceSwitch()`

4. **设备状态检查**
   - 获取设备当前属性
   - 检查 `CHSWT1` 状态

5. **设备控制**
   - 如果已打开：显示"设备已通电"
   - 如果未打开：自动打开并显示"设备已通电"

6. **页面跳转**
   - 1秒后跳转到订单详情页面

## 错误处理

- **网络错误**：显示"检查设备状态失败"
- **设备控制失败**：显示"通电失败，请手动操作"
- **API错误**：显示具体错误信息

## 配置说明

### API端点
- 设备属性获取：`http://localhost:8000/device/properties` (GET)
- 设备属性设置：`http://localhost:8000/device/property/set?identifier=CHSWT1&value=1` (POST)

### 设备属性
- 开关一标识符：`CHSWT1`
- 开启值：`'1'`
- 关闭值：`'0'`

## 注意事项

1. **网络依赖**：需要确保后端API服务正常运行
2. **设备连接**：需要确保IoT设备在线且可控制
3. **权限验证**：后端API需要正确处理设备控制权限
4. **错误恢复**：如果自动控制失败，用户可手动在设备管理页面操作

## 扩展功能

### 可扩展的控制选项
- 支持控制其他设备属性（如 `CHSWT2`、`PWRS` 等）
- 支持批量设备控制
- 支持设备状态监控和通知

### 集成其他页面
- 可在其他需要设备控制的页面中复用这些方法
- 支持设备状态的全局管理
- 支持设备控制的历史记录
