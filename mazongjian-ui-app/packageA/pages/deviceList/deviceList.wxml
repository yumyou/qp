<!--pages/deviceList/deviceList.wxml-->
<view class="tabs">
  <van-dropdown-menu active-color="#1890ff">
    <van-dropdown-item value="{{ storeId }}" options="{{ stores }}" bind:change="storeDropdown" />
    <van-dropdown-item value="{{ deviceType }}" options="{{ deviceTypes }}" bind:change="typeDropdown" />
  </van-dropdown-menu>
</view>

<view class="container">
  <!-- è®¾å¤‡åˆ—è¡¨ -->
  <view class="list" wx:if="{{deviceList.length > 0}}">
    <view class="item {{item.status==1?'online':'offline'}}" wx:for="{{deviceList}}" wx:key="deviceId">
      <view class="line1">
        <view class="info">
          <label>ç¼–å·</label>
          <text class="sn">{{item.deviceSn}}</text>
        </view>
        <view class="info">
          <label>ç±»å‹</label>
          <text>{{item.type==1?'é—¨ç¦':item.type==2?'ç©ºå¼€':item.type==3?'äº‘å–‡å­':item.type==4?'ç¯å…·':item.type==5?'å¯†ç é”':item.type==6?'ç½‘å…³':item.type==7?'æ’åº§':item.type==8?'é”çƒå™¨æ§åˆ¶å™¨ï¼ˆ12Vï¼‰':item.type==9?'äººè„¸é—¨ç¦æœº':item.type==10?'æ™ºèƒ½è¯­éŸ³å–‡å­':item.type==11?'äºŒç»´ç è¯†åˆ«å™¨':item.type==12?'çº¢å¤–æ§åˆ¶å™¨':item.type==13?'ä¸‰è·¯æ§åˆ¶å™¨':'ç”µæ§'}}</text>
        </view>
        <view class="info" wx:if="{{item.type!=6&&item.type!=5}}">
          <label>çŠ¶æ€</label>
          <text class="status {{item.status==1?'online':'offline'}}">{{item.status==1?'åœ¨çº¿':'ç¦»çº¿'}}</text>
        </view>
      </view>
      <view class="line2">
        <view class="info" wx:if="{{item.storeName}}">
          <label>é—¨åº—</label>
          <text class="name">{{item.storeName}}</text>
        </view>
        <view class="info">
          <label>æˆ¿é—´</label>
          <text>{{item.roomName || '-'}}</text>
        </view>
        <view class="actions">
          <view class="bind" bindtap="bindDevice" data-id="{{item.deviceId}}" data-storeid="{{item.storeId}}">
            ç»‘å®š
          </view>
          <view class="del" bindtap="delDevice" data-id="{{item.deviceId}}">
            åˆ é™¤
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{deviceList.length === 0}}">
    <view class="icon">ğŸ“±</view>
    <view class="text">æš‚æ— è®¾å¤‡æ•°æ®</view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{!canLoadMore && deviceList.length > 0}}">
    - å·²åŠ è½½å…¨éƒ¨æ•°æ® -
  </view>
</view>

<!-- åº•éƒ¨æŒ‰é’® -->
<view class="bottom {{isIpx?'fix-iphonex-button':''}}">
   <view class="btn bg-primary" bindtap="add">æ·»åŠ è®¾å¤‡</view>
</view>

<!-- æ·»åŠ å¼¹çª— -->
<van-dialog
  use-slot
  title="æ·»åŠ è®¾å¤‡"
  show="{{ showAdd }}"
  show-cancel-button
  bind:confirm="submitAdd"
  bind:cancel="cancelAdd" 
  before-close="{{beforeCloseFunction}}"
  confirm-button-color="#1890ff"
>
  <view class="dialog">
    <van-cell-group>
      <van-field
        label="è®¾å¤‡ç±»å‹"
        placeholder="è¯·é€‰æ‹©"
        required
      >
        <picker slot="input" bindchange="bindDeviceTypeSelect" value="{{deviceTypeIndex}}" range-key="text" range="{{deviceTypes}}">
          <view class="picker">
            <input type="text" disabled placeholder="è¯·é€‰æ‹©ç±»å‹" placeholder-class="plh" value="{{deviceTypes[deviceTypeIndex].text}}"/>
            <van-icon name="arrow-down" />
          </view>
        </picker>
      </van-field>
      
      <van-field
        wx:if="{{deviceTypeIndex != 2}}"
        model:value="{{deviceSn}}"
        label="è®¾å¤‡ç¼–å·"
        maxlength="10"
        placeholder="è¯·è¾“å…¥è®¾å¤‡ç¼–å·ï¼Œæœ€é•¿10ä½"
        required
      />
      
      <van-field
        wx:if="{{deviceTypeIndex == 2}}"
        model:value="{{productKey}}"
        label="è®¾å¤‡å¯†é’¥"
        maxlength="20"
        placeholder="è¯·è¾“å…¥è®¾å¤‡å¯†é’¥"
        required
      />
      
      <van-field
        wx:if="{{deviceTypeIndex == 2}}"
        model:value="{{deviceName}}"
        label="è®¾å¤‡åç§°"
        maxlength="20"
        placeholder="è¯·è¾“å…¥è®¾å¤‡åç§°"
        required
      />
      
      <van-field
        wx:if="{{deviceTypeIndex == 2}}"
        label="çº¿è·¯"
        placeholder="è¯·é€‰æ‹©çº¿è·¯"
        required
      >
        <picker slot="input" bindchange="bindIdentifierSelect" value="{{identifierIndex}}" range-key="text" range="{{identifierList}}">
          <view class="picker">
            <input type="text" disabled placeholder="è¯·é€‰æ‹©çº¿è·¯" placeholder-class="plh" value="{{identifierIndex > 0 ? identifierList[identifierIndex].text : ''}}"/>
            <van-icon name="arrow-down" />
          </view>
        </picker>
      </van-field>

      <van-field
        label="é—¨åº—"
        placeholder="è¯·é€‰æ‹©é—¨åº—"
        required
      >
        <picker slot="input" bindchange="bindStoreSelect" value="{{storeIndex}}" range-key="text" range="{{stores}}">
          <view class="picker">
            <input type="text" disabled placeholder="è¯·é€‰æ‹©é—¨åº—" placeholder-class="plh" value="{{stores[storeIndex].text}}"/>
            <van-icon name="arrow-down" />
          </view>
        </picker>
      </van-field>
      
      <van-field
        label="æˆ¿é—´"
        placeholder="è¯·é€‰æ‹©æˆ¿é—´"
      >
        <picker slot="input" bindchange="bindRoomSelect" value="{{roomIndex}}" range-key="text" range="{{roomList}}">
          <view class="picker">
            <input type="text" disabled placeholder="è¯·é€‰æ‹©æˆ¿é—´" placeholder-class="plh" value="{{roomList[roomIndex].text}}"/>
            <van-icon name="arrow-down" />
          </view>
        </picker>
      </van-field>
      
      <view class="switch-container">
        <text class="switch-label">å…±ç”¨è®¾å¤‡</text>
        <switch bindchange="changeSwitchStatus" checked="{{shareDevice}}" color="#1890ff"/>
      </view>
    </van-cell-group>
  </view>
</van-dialog>

<!-- ç»‘å®šå¼¹çª— -->
<van-dialog
  use-slot
  title="ä¿®æ”¹è®¾å¤‡ç»‘å®š"
  show="{{ showBind }}"
  show-cancel-button
  bind:confirm="bindDeviceConfirm"
  bind:cancel="bindDeviceCancel"
  confirm-button-color="#1890ff"
>
  <view class="dialog">
    <van-cell-group>
      <van-field
        label="é—¨åº—"
        placeholder="è¯·é€‰æ‹©é—¨åº—"
        required
      >
        <picker slot="input" bindchange="bindBindStoreSelect" value="{{bindStoreIndex}}" range-key="text" range="{{stores}}">
          <view class="picker">
            <input type="text" disabled placeholder="è¯·é€‰æ‹©é—¨åº—" placeholder-class="plh" value="{{stores[bindStoreIndex].text}}"/>
            <van-icon name="arrow-down" />
          </view>
        </picker>
      </van-field>
      
      <van-field
        label="æˆ¿é—´"
        placeholder="è¯·é€‰æ‹©æˆ¿é—´"
        required
      >
        <picker slot="input" bindchange="bindBindRoomSelect" value="{{bindRoomIndex}}" range-key="text" range="{{roomList}}">
          <view class="picker">
            <input type="text" disabled placeholder="è¯·é€‰æ‹©æˆ¿é—´" placeholder-class="plh" value="{{roomList[bindRoomIndex].text}}"/>
            <van-icon name="arrow-down" />
          </view>
        </picker>
      </van-field>
    </van-cell-group>
  </view>
</van-dialog>
